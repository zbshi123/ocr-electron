import{i as e,a}from"./ipcRenderer-36c8fd5f.js";import{a as l}from"./index-ae6c698a.js";import{_ as s,r as t,o as i,c as o,a as n,b as d,w as r,d as c,e as m,F as g,f as h,p as u,g as p,t as b,h as v,v as f,i as _}from"./index-c3624d72.js";const y={class:"container"},k={class:"area1"},I={class:"area1-left"},U=["src"],C={class:"area1-right"},F=["src"],O={class:"area2"},D={key:0};const w=s({components:{},name:"PictureUpload",data:()=>({file:null,imageUrl:null,processedImageUrl:null,loading:!1,response:null}),methods:{handleFileUpload(e){this.file=e.target.files[0];const a=new FileReader;a.readAsDataURL(this.file),a.onload=()=>{this.imageUrl=a.result,console.log(this.imageUrl)}},uploadFile(){if(this.file){console.log("上传文件:",this.file);try{this.loading=!0;const e={key:this.imageUrl};l.post("http://127.0.0.1:7074/api/post_data",e).then((e=>{console.log(e),this.response=JSON.stringify(e),this.processedImageUrl=this.imageUrl}))}catch(e){console.error("发送请求错误:",e)}finally{this.loading=!1}}else alert("请先选择文件")},uploadFileByIPC(){this.file?(console.log("上传文件:",this.file),e.invoke(a.imgResolve,[this.imageUrl]).then((e=>{console.log(e),alert(e)}))):alert("请先选择文件")}}},[["render",function(e,a,l,s,g,h){const u=t("a-button");return i(),o("div",y,[n("input",{type:"file",onChange:a[0]||(a[0]=(...e)=>h.handleFileUpload&&h.handleFileUpload(...e))},null,32),d(u,{onClick:h.uploadFile},{default:r((()=>[c("上传图片")])),_:1},8,["onClick"]),n("div",k,[n("div",I,[g.imageUrl?(i(),o("img",{key:0,src:g.imageUrl,alt:"Uploaded Image"},null,8,U)):m("",!0)]),n("div",C,[g.processedImageUrl?(i(),o("img",{key:0,src:g.processedImageUrl,alt:"Uploaded Image"},null,8,F)):m("",!0)])]),n("div",O,[g.loading?(i(),o("div",D,"发送中...")):m("",!0)])])}],["__scopeId","data-v-b7b6f96e"]]),$={name:"ImageUploader",data:()=>({thumbnails:[],all_list:[]}),methods:{handleFileChange(e){const a=e.target.files;if(a)for(let l=0;l<a.length;l++){const e=a[l];if(!e.type.startsWith("image/"))continue;const s=new FileReader;s.onload=a=>{this.thumbnails.push({url:a.target.result,file:e}),console.log(this.thumbnails)},s.readAsDataURL(e)}},removeThumbnail(e){this.thumbnails.splice(e,1)},uploadFile(){if(this.thumbnails.length<=0)alert("请先选择文件");else{console.log("上传文件:",this.thumbnails);try{for(let e=0;e<this.thumbnails.length;e++){let a=this.generateTag(e),l=this.thumbnails[e].url;this.dbAddImage(a,l)}}catch(e){console.error("发送请求错误:",e)}finally{window.location.reload()}}},jsonDbAddImage(l,s){const t={action:"add",image:{tag:l,image_url:s}};e.invoke(a.jsondbOperation,t).then((e=>{console.log("res:",e),this.all_list=e.all_list,this.$message.success("success"),console.log(this.all_list)}))},dbAddImage(l,s){const t={function_name:"addImage",image:{description:l,image_url:s}};e.invoke(a.sqlitedbOperation,t).then((e=>{console.log("res:",e),this.all_list=e.all_list,this.$message.success("success"),console.log(this.all_list)}))},generateTag:e=>`${(new Date).getTime()}-${e}`}},T=e=>(u("data-v-c16d9921"),e=e(),p(),e),j={class:"container"},A={class:"area1"},M=T((()=>n("label",{for:"submit"},[n("div",{class:"label-button"},"选择文件")],-1))),x=T((()=>n("hr",{class:"hr"},null,-1))),R={class:"area2"},P={key:0},S=["src","alt"],B=["onClick"];const q=s($,[["render",function(e,a,l,s,t,d){return i(),o("div",j,[n("div",A,[M,n("input",{id:"submit",style:{display:"none"},type:"file",onChange:a[0]||(a[0]=(...e)=>d.handleFileChange&&d.handleFileChange(...e)),multiple:"",accept:"image/*"},null,32),n("button",{onClick:a[1]||(a[1]=(...e)=>d.uploadFile&&d.uploadFile(...e))},"上传图片")]),x,n("div",R,[t.thumbnails.length>0?(i(),o("div",P,[(i(!0),o(g,null,h(t.thumbnails,((e,a)=>(i(),o("div",{key:a,class:"thumbnail"},[n("img",{src:e.url,alt:"Thumbnail "+(a+1)},null,8,S),n("button",{onClick:e=>d.removeThumbnail(a)},"取消",8,B)])))),128))])):m("",!0)])])}],["__scopeId","data-v-c16d9921"]]),E={name:"ImageDisplayer",data:()=>({image_data:[]}),mounted(){console.log("mounted: 组件已挂载"),this.dbGetImages()},computed:{image_size(){const e=JSON.stringify(this.image_data);return(new Blob([e]).size/1024/1024).toFixed(2)+" MB"}},methods:{deleteImage(e){const a=this.image_data[e].id;this.dbDeleteImage(a)},jsonDbGetImages(){e.invoke(a.jsondbOperation,{action:"getAllImageData"}).then((e=>{console.log("res:",e),this.image_data=e.all_list,console.log(this.image_data)}))},jsonDbDeleteImage(l){const s={action:"delByTag",delete_tag:l};try{e.invoke(a.jsondbOperation,s).then((e=>{console.log("res:",e),this.image_data=e.all_list,this.$message.success("success"),console.log(this.image_data)}))}catch(t){console.log("删除错误"+t)}},dbGetImages(){e.invoke(a.sqlitedbOperation,{function_name:"getAllImages"}).then((e=>{console.log("res:",e),this.image_data=e.all_list,console.log(this.image_data)}))},dbDeleteImage(l){const s={function_name:"deleteImageById",id:l};try{e.invoke(a.sqlitedbOperation,s).then((e=>{console.log("res:",e),this.image_data=e.all_list,this.$message.success("success"),console.log(this.image_data)}))}catch(t){console.log("删除错误"+t)}}}},z={class:"container"},G=(e=>(u("data-v-a48e5d86"),e=e(),p(),e))((()=>n("hr",{class:"hr"},null,-1))),L={class:"area2"},J={key:0},N=["src","alt"],V=["onClick"];const W=s(E,[["render",function(e,a,l,s,t,d){return i(),o("div",z,[n("div",null," 本地数据库中的图片："+b(d.image_size),1),G,n("div",L,[t.image_data.length>0?(i(),o("div",J,[(i(!0),o(g,null,h(t.image_data,((e,a)=>(i(),o("div",{key:a,class:"thumbnail"},[n("img",{src:e.image_url,alt:"Thumbnail "+(a+1)},null,8,N),n("button",{onClick:e=>d.deleteImage(a)},"删除",8,V)])))),128))])):m("",!0)])])}],["__scopeId","data-v-a48e5d86"]]),H={name:"Camera",mounted(){},data:()=>({isCameraOn:!1,videoStream:null,imageUrl:"",thumbnails:[],all_list:[]}),methods:{async startCamera(){try{const e=await navigator.mediaDevices.getUserMedia({video:!0});this.$refs.video.srcObject=e}catch(e){console.error("Error accessing camera:",e)}},async toggleCamera(){if(this.isCameraOn)this.videoStream&&(this.videoStream.getTracks().forEach((e=>e.stop())),this.$refs.video.srcObject=null,this.isCameraOn=!1);else try{const e=await navigator.mediaDevices.getUserMedia({video:!0});this.$refs.video.srcObject=e,this.isCameraOn=!0,this.videoStream=e}catch(e){console.error("Error accessing camera:",e)}},takePicture(){const e=document.createElement("canvas");e.width=this.$refs.video.videoWidth,e.height=this.$refs.video.videoHeight,e.getContext("2d").drawImage(this.$refs.video,0,0,e.width,e.height),this.imageUrl=e.toDataURL("image/png"),this.thumbnails.push({url:this.imageUrl})},removeThumbnail(e){this.thumbnails.splice(e,1)},generateTag:e=>`${(new Date).getTime()}-${e}`,jsonDbAddImage(l,s){const t={action:"add",image:{tag:l,image_url:s}};e.invoke(a.jsondbOperation,t).then((e=>{console.log("res:",e),this.all_list=e.all_list,this.$message.success("success"),console.log(this.all_list)}))},dbAddImage(l,s){const t={function_name:"addImage",image:{description:l,image_url:s}};e.invoke(a.sqlitedbOperation,t).then((e=>{console.log("res:",e),this.all_list=e.all_list,this.$message.success("success"),console.log(this.all_list)}))},uploadFile(){if(this.thumbnails.length<=0)alert("请先拍摄照片");else{console.log("上传文件:",this.thumbnails);try{for(let e=0;e<this.thumbnails.length;e++){let a=this.generateTag(e),l=this.thumbnails[e].url;this.dbAddImage(a,l)}}catch(e){console.error("错误:",e)}finally{window.location.reload()}}}}},K={class:"container"},Q={class:"area1"},X={class:"button-area"},Y=["disabled"],Z={class:"video-area"},ee={ref:"video",autoplay:""},ae=(e=>(u("data-v-a2eb11c1"),e=e(),p(),e))((()=>n("div",{class:"line"},null,-1))),le={class:"area2"},se={key:0},te=["src","alt"],ie=["onClick"];const oe={components:{PictureUpload:w,ImageUploader:q,ImageDisplayer:W,Camera:s(H,[["render",function(e,a,l,s,t,d){return i(),o("div",K,[n("div",Q,[n("div",X,[n("button",{id:"button1",onClick:a[0]||(a[0]=(...e)=>d.toggleCamera&&d.toggleCamera(...e))},b(t.isCameraOn?"关闭相机":"开启相机"),1),n("button",{id:"button2",onClick:a[1]||(a[1]=(...e)=>d.takePicture&&d.takePicture(...e)),disabled:!t.isCameraOn},"截取照片",8,Y),n("button",{id:"button3",onClick:a[2]||(a[2]=(...e)=>d.uploadFile&&d.uploadFile(...e))},"上传照片")]),n("div",Z,[n("video",ee,null,512)])]),ae,n("div",le,[t.thumbnails.length>0?(i(),o("div",se,[(i(!0),o(g,null,h(t.thumbnails,((e,a)=>(i(),o("div",{key:a,class:"thumbnail"},[n("img",{src:e.url,alt:"Thumbnail "+(a+1)},null,8,te),n("button",{onClick:e=>d.removeThumbnail(a)},"取消",8,ie)])))),128))])):m("",!0)])])}],["__scopeId","data-v-a2eb11c1"]])},name:"Upload",data:()=>({uploadMode:"file"})},ne=e=>(u("data-v-d7a93e09"),e=e(),p(),e),de={class:"view"},re=ne((()=>n("div",{style:{"padding-left":"4px"}},[n("h2",null,"上传图片或照片")],-1))),ce={class:"radio-box"},me=ne((()=>n("label",{class:"radio-label",for:"fileUpload"},"文件上传",-1))),ge=ne((()=>n("label",{class:"radio-label",for:"cameraUpload"},"拍照上传",-1))),he=ne((()=>n("br",null,null,-1)));const ue=s(oe,[["render",function(e,a,l,s,r,c){const g=t("camera"),h=t("image-uploader"),u=t("image-displayer");return i(),o("div",de,[re,n("div",ce,[v(n("input",{class:"radio-input",type:"radio",id:"fileUpload",value:"file","onUpdate:modelValue":a[0]||(a[0]=e=>r.uploadMode=e)},null,512),[[f,r.uploadMode]]),me,v(n("input",{class:"radio-input",type:"radio",id:"cameraUpload",value:"camera","onUpdate:modelValue":a[1]||(a[1]=e=>r.uploadMode=e)},null,512),[[f,r.uploadMode]]),ge]),"camera"===r.uploadMode?(i(),_(g,{key:0})):m("",!0),"file"===r.uploadMode?(i(),_(h,{key:1})):m("",!0),he,d(u)])}],["__scopeId","data-v-d7a93e09"]]);export{ue as default};
